<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:cassandra-db="http://www.mulesoft.org/schema/mule/cassandra-db"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:munit="http://www.mulesoft.org/schema/mule/munit"
	xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd 
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd
http://www.mulesoft.org/schema/mule/cassandra-db http://www.mulesoft.org/schema/mule/cassandra-db/current/mule-cassandra-db.xsd">
	<munit:config name="CreateTableTestCase.xml" />
	<munit:test name="testCreateTableWithSuccess" description="MUnit Test" doc:id="2f66016f-14d4-463c-ac3d-a3e0b3171932">
		<munit:execution >
			<flow-ref doc:name="createTable" doc:id="86d4914e-4471-4edc-8998-33ba9670bdaa" name="createTableFlow" />
		</munit:execution>
		<munit:validation >
			<munit-tools:assert doc:name="createdSuccessful" doc:id="268af9dd-7848-462c-9b24-a86cf24de180" />
		</munit:validation>
	</munit:test>
	<munit:test name="testCreateTableWithCompositePKWithSuccess" description="MUnit Test" doc:id="5d7da591-a993-42ea-aeae-beb13a882170">
		<munit:behavior >
			<ee:transform doc:name="testData" doc:id="ca134f1b-76f2-4404-8abd-ad6d8f2d1db8">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="testData"><![CDATA[%dw 2.0
output application/java
import * from dw::core::Strings
var randomChar1=fromCharCode(randomInt(25) + 97)
var randomChar2=fromCharCode(randomInt(25) + 97)
var randomChar3=fromCharCode(randomInt(25) + 97)
var randomChar4=fromCharCode(randomInt(25) + 97)
var randomChar5=fromCharCode(randomInt(25) + 97)
fun randomColumnName()=
	randomChar1 ++ randomChar2 ++ randomChar3 ++ randomChar4 ++ randomChar5
---
{
	name: "DUMMY_PARTITION_KEY",
	primaryKey: true,
	"type": "TEXT" as Enum {
			class: "org.mule.modules.cassandradb.api.ColumnType"
		},
	keyspaceName: "demo_keyspace",
	tableName: "dummy_table_name_1",
	tableName2: "dummy_table_name_2",
	randomColumn: randomColumnName(),
	column:"dummy_column_1"
}]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<ee:transform doc:name="createTableInput" doc:id="e4153bb2-d0ba-4774-bea6-9a0abf61579d">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/java
---
{
	columns: [{
		name: vars.testData.name,
		primaryKey: vars.testData.primaryKey,
		"type": vars.testData."type"
	}],
	keyspaceName: vars.testData.keyspaceName,
	tableName: vars.testData.tableName2
} as Object {
	class : "org.mule.modules.cassandradb.api.CreateTableInput"
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		</munit:behavior>
		<munit:execution >
		<cassandra-db:create-table config-ref="Cassandra_Basic_Config">
        </cassandra-db:create-table>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert doc:name="createdSuccessful" doc:id="b85af687-c6e0-419b-867d-9494a7c2471c" />
		</munit:validation>
	</munit:test>
	<munit:after-test name="tearDownCreateTableTest" description="After tests actions" doc:id="75e9fe95-65d0-4d0d-9a24-81f705b49f85" >
		<flow-ref doc:name=" dropTable" doc:id="bf579267-ea8f-4f68-aa38-27eb0eed31a3" name="dropTableFlow"/>
	</munit:after-test>


</mule>
